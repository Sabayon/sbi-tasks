name: "Build mocaccino desktop"
image: sabayon/ci
type: lxd
queue: lxd
directory: "/"
storage: 'mocaccino-credentials'
source: https://github.com/mocaccinoOS/mocaccino-desktop
environment:
- BUILD_ARGS=--pull --push --image-repository mocaccinoos/desktop-cache
- LUET_CONFIG="conf/luet.yaml"
- LUET_GENERAL__DEBUG=true
- SUDO=sudo -E

script:
- sleep 5
- systemctl start docker
- source storage/env
- git clone https://github.com/mocaccinoOS/desktop mocaccino-desktop
- cd mocaccino-desktop
- mkdir -p $HOME/.docker
- 'echo "{\"experimental\": \"enabled\",\"auths\": { \"https://index.docker.io/v1/\": {}}}" > $HOME/.docker/config.json'
- docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker ps
- curl https://gist.githubusercontent.com/mudler/8b8d6c53c4669f4b9f9a72d1a2b92172/raw/114dcc00bad41896f8614cc0214f834b95a1e2a6/get_luet_root.sh | sudo sh
- sudo luet install system/container-diff system/luet-extensions
- BACKEND=docker make build-all create-repo
- curl https://gist.githubusercontent.com/mudler/87a5da08bacae8ea69b8f15497534d8d/raw/26109389ea6eb5f0b8b54c9711509e5ec974b1d2/keybase_cp.sh > keybase_cp.sh
- bash keybase_cp.sh $PWD/build /keybase/public/mocaccino/desktop


planned: "@daily"
